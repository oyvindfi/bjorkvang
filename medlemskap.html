<!DOCTYPE html>
<html lang="nb">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Medlemskap ‚Äì Bj√∏rkvang forsamlingslokale</title>
    <meta name="description" content="Bli medlem i Helg√∏ens Vel og st√∏tt driften av Bj√∏rkvang.">

    <meta property="og:type" content="website">
    <meta property="og:url" content="https://bj√∏rkvang.no/medlemskap">
    <meta property="og:title" content="Medlemskap ‚Äì Bj√∏rkvang forsamlingslokale">
    <meta property="og:description" content="Bli medlem i Helg√∏ens Vel og st√∏tt driften av Bj√∏rkvang.">
    <meta property="og:image" content="https://bj√∏rkvang.no/images/bjorkvang-sommer.png">

    <link rel="canonical" href="https://bj√∏rkvang.no/medlemskap">
    <link rel="icon" href="images/favicon.svg" type="image/svg+xml">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <a class="skip-link" href="#main-content">Hopp til hovedinnhold</a>
    <header class="site-header">
        <div class="container nav-container">
            <div class="branding">
                <a class="logo" href="/">
                    <span class="logo-mark" aria-hidden="true">BV</span>
                    <span class="logo-text">
                        <span class="logo-title">Bj√∏rkvang forsamlingslokale</span>
                        <span class="logo-subtitle">Helg√∏ens Vel</span>
                    </span>
                </a>
            </div>
            <button class="nav-toggle" type="button" aria-expanded="false" aria-controls="primary-nav">
                <span class="sr-only">√Öpne hovedmenyen</span>
                <span></span>
                <span></span>
                <span></span>
            </button>
            <nav class="site-nav" id="primary-nav" aria-label="Hovedmeny">
                <ul>
                    <li><a href="/">Hjem</a></li>
                    <li><a href="lokaler">V√•re&nbsp;lokaler</a></li>
                    <li><a href="booking#calendar">Kalender</a></li>
                    <li><a href="booking">Lei&nbsp;lokalet</a></li>
                    <li><a href="medlemskap" aria-current="page">Medlemskap</a></li>
                    <li><a href="nyheter">Nyheter</a></li>
                    <li><a href="kontakt">Kontakt</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <div class="header-shortcuts">
        <div class="container shortcuts-container">
            <a href="booking#calendar" class="shortcut-link">
                <span class="shortcut-icon">üìÖ</span>
                <span class="shortcut-text">Kalender</span>
            </a>
            <a href="booking" class="shortcut-link">
                <span class="shortcut-icon">üè†</span>
                <span class="shortcut-text">Lei lokalet</span>
            </a>
            <a href="lokaler" class="shortcut-link">
                <span class="shortcut-icon">üö™</span>
                <span class="shortcut-text">V√•re lokaler</span>
            </a>
            <a href="medlemskap" class="shortcut-link">
                <span class="shortcut-icon">‚≠ê</span>
                <span class="shortcut-text">Bli medlem</span>
            </a>
            <a href="kontakt" class="shortcut-link">
                <span class="shortcut-icon">‚úâÔ∏è</span>
                <span class="shortcut-text">Kontakt oss</span>
            </a>
        </div>
    </div>

    <section class="page-hero" aria-labelledby="membership-title">
        <div class="container hero-inner">
            <div class="hero-content">
                <span class="hero-eyebrow">Fellesskap</span>
                <h1 id="membership-title">Bli medlem i Helg√∏ens Vel</h1>
                <p>St√∏tt Bj√∏rkvang med 250 kr i √•ret. Medlemmer f√•r rabatt p√• leie.</p>
                <div class="hero-actions">
                    <a class="button" href="#betal">Bli medlem n√•</a>
                </div>
            </div>
            <figure class="hero-media">
                <img src="images/bjorkvang-vinter.png" alt="Bj√∏rkvang forsamlingslokale i vinterlys">
            </figure>
        </div>
    </section>

    <main class="page-main" id="main-content">
        <section class="page-section">
            <div class="container">
                <div class="section-heading">
                    <h2>Hvorfor bli medlem?</h2>
                    <p>Medlemskontingenten g√•r direkte til drift og videreutvikling av forsamlingshuset v√•rt.</p>
                </div>
                <ul class="feature-list">
                    <li><strong>Rabatt p√• leie:</strong> Medlemmer f√•r reduserte priser p√• leie av lokalet.</li>
                    <li><strong>St√∏tte til n√¶rmilj√∏et:</strong> Bidraget ditt gir oss mulighet til √• vedlikeholde og utvikle Bj√∏rkvang.</li>
                </ul>
            </div>
        </section>

        <section class="page-section" id="betal">
            <div class="container">
                <div class="vipps-callout" aria-labelledby="vipps-heading">
                    <h2 id="vipps-heading">Bli medlem</h2>
                    <p>Medlemskap koster <strong>250 kr</strong> per √•r.</p>
                    
                    <div class="vipps-payment-container">
                        <p>Betal enkelt med Vipps for √• registrere ditt medlemskap:</p>
                        
                        <button id="vipps-pay-btn" class="button vipps-button">
                            <span class="vipps-icon">V</span>
                            Betal med Vipps
                        </button>
                        <p id="vipps-status" class="form-status" style="display:none; margin-top: 1rem;"></p>
                    </div>

                    <div class="manual-payment-details">
                        <p class="small-text">Alternativt kan du betale manuelt:</p>
                        <ul class="vipps-steps small-text">
                            <li><strong>Vipps-nummer:</strong> #104631 (merk med ¬´Medlemskap¬ª)</li>
                            <li><strong>Konto:</strong> 1822.40.12345 (merk med ¬´Medlemskap¬ª)</li>
                        </ul>
                    </div>
                    
                    <p class="membership-note">Kontingenten gjelder per kalender√•r. Velkommen som medlem!</p>
                </div>
            </div>
        </section>

        <script>
            document.getElementById('vipps-pay-btn').addEventListener('click', async () => {
                const btn = document.getElementById('vipps-pay-btn');
                const statusEl = document.getElementById('vipps-status');

                btn.disabled = true;
                btn.textContent = 'Laster...';
                if (statusEl) statusEl.style.display = 'none';

                try {
                    // Determine API URL based on environment
                    const isLocal = window.location.hostname === '127.0.0.1' || window.location.hostname === 'localhost';
                    const apiBase = isLocal ? 'http://localhost:7071' : 'https://bjorkvang-duhsaxahgfe0btgv.westeurope-01.azurewebsites.net';

                    const response = await fetch(`${apiBase}/api/vipps/initiate`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({})
                    });

                    const data = await response.json();

                    if (response.ok && data.url) {
                        window.location.href = data.url;
                    } else {
                        throw new Error(data.error || 'Kunne ikke starte Vipps-betaling');
                    }
                } catch (err) {
                    console.error(err);
                    if (statusEl) {
                        statusEl.textContent = 'Beklager, noe gikk galt. Vennligst pr√∏v manuell betaling.';
                        statusEl.style.display = 'block';
                        statusEl.classList.add('is-error');
                    }
                    btn.disabled = false;
                    btn.innerHTML = '<span class="vipps-icon">V</span> Betal med Vipps';
                }
            });

            // Check for success query param
            const urlParams = new URLSearchParams(window.location.search);
            if (urlParams.get('status') === 'success') {
                const container = document.querySelector('.vipps-payment-container');
                if (container) {
                    container.innerHTML = `
                        <div class="success-message" style="text-align: center; color: var(--brand-600);">
                            <h3 style="margin-top:0;">Takk for din betaling!</h3>
                            <p>Ditt medlemskap er n√• registrert.</p>
                        </div>
                    `;
                }
            }
        </script>

        <section class="page-section">
            <div class="container">
                <div class="info-grid">
                    <article class="info-card">
                        <h3>Grasrotandelen</h3>
                        <p>St√∏tt Helg√∏ens Vel via Norsk Tippings Grasrotandel.</p>
                        <p><strong>Org.nr:</strong> 995 519 240</p>
                    </article>
                    <article class="info-card">
                        <h3>Sp√∏rsm√•l?</h3>
                        <p>Kontakt styret hvis du lurer p√• noe om medlemskap eller betaling.</p>
                        <p><a class="text-link" href="kontakt">Kontakt oss</a></p>
                    </article>
                </div>
            </div>
        </section>
    </main>

    <footer class="site-footer">
        <div class="container footer-grid">
            <div>
                <h2 class="footer-title">Bj√∏rkvang forsamlingslokale</h2>
                <p>Et inkluderende forsamlingshus p√• Helg√∏ya som rommer m√∏ter, feiringer og fellesskap.</p>
            </div>
            <div>
                <h2 class="footer-title">Snarveier</h2>
                <ul class="footer-links">
                    <li><a href="lokaler">V√•re&nbsp;lokaler</a></li>
                    <li><a href="booking">Lei&nbsp;lokalet</a></li>
                    <li><a href="medlemskap" aria-current="page">Medlemskap</a></li>
                    <li><a href="nyheter">Nyheter</a></li>
                    <li>
                        <button type="button" class="copy-link-btn btn-share" aria-label="Kopier lenke til denne siden">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13.12 17.023l-4.199-2.29a4 4 0 1 1 0-5.465l4.2-2.29a4 4 0 1 1 .959 1.755l-4.2 2.29a4.008 4.008 0 0 1 0 1.954l4.199 2.29a4 4 0 1 1-.959 1.755zM6 14a2 2 0 1 0 0-4 2 2 0 0 0 0 4zm11-6a2 2 0 1 0 0-4 2 2 0 0 0 0 4zm0 12a2 2 0 1 0 0-4 2 2 0 0 0 0 4z"/></svg>
                            <span>Del siden</span>
                        </button>
                    </li>
                </ul>
            </div>
            <div>
                <h2 class="footer-title">Kontakt</h2>
                <ul class="footer-contact">
                    <li><a href="mailto:styret@bj√∏rkvang.no">styret@bj√∏rkvang.no</a></li>
                    <li><a href="tel:+4748060273">+47 480 60 273</a></li>
                    <li>Helg√∏ya, Ringsaker</li>
                </ul>
            </div>
        </div>
        <p class="footer-meta">&copy; 2025 Bj√∏rkvang forsamlingslokale og Helg√∏ens Vel.</p>
    </footer>

    <script src="app.js"></script>
    <script>
        // Check for return from Vipps on page load
        document.addEventListener('DOMContentLoaded', async () => {
            const statusEl = document.getElementById('vipps-status');
            const payBtn = document.getElementById('vipps-pay-btn');

            const urlParams = new URLSearchParams(window.location.search);
            const orderId = urlParams.get('orderId');
            const statusParam = urlParams.get('status');

            if (orderId && statusParam === 'success') {
                statusEl.style.display = 'block';
                statusEl.textContent = 'Sjekker betalingsstatus...';
                statusEl.className = 'form-status';

                try {
                    const isLocal = window.location.hostname === '127.0.0.1' || window.location.hostname === 'localhost';
                    const apiBase = isLocal ? 'http://localhost:7071' : 'https://bjorkvang-duhsaxahgfe0btgv.westeurope-01.azurewebsites.net';

                    const response = await fetch(`${apiBase}/api/vipps/check-status`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ orderId })
                    });

                    const data = await response.json();

                    if (data.status === 'AUTHORIZED' || data.status === 'CAPTURED') {
                        statusEl.textContent = 'Takk! Ditt medlemskap er betalt og registrert.';
                        statusEl.className = 'form-status is-success';
                        payBtn.style.display = 'none';
                    } else {
                        statusEl.textContent = 'Betalingen ble ikke fullf√∏rt. Pr√∏v igjen.';
                        statusEl.className = 'form-status is-error';
                    }
                } catch (err) {
                    console.error(err);
                    statusEl.textContent = 'Kunne ikke verifisere betalingen. Ta kontakt hvis bel√∏pet er trukket.';
                    statusEl.className = 'form-status is-error';
                }
            }
        });
    </script>
</body>
</html>